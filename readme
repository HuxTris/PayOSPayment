 Để chạy demo này, bạn cần làm theo các bước sau:

  A. Cấu hình PayOS API Keys

   1. Mở tệp server/.env mà tôi đã tạo.
   2. Thay thế your-client-id, your-api-key, your-checksum-key bằng thông tin API Keys của bạn từ tài khoản PayOS (truy cập trang quản lý PayOS để lấy).

  B. Khởi động Backend Server

   1. Mở một cửa sổ Terminal/Command Prompt mới.
   2. Điều hướng đến thư mục server:
   1     cd D:\UIT\Document_UIT\3th-Year\IE307\DEMO_SEMINAR\server
   3. Cài đặt dependencies nếu bạn chưa làm (tôi đã chạy lệnh này ở trên):
   1     npm install
   4. Khởi động server:
   1     npm start
      Bạn sẽ thấy thông báo Server is listening at http://localhost:3000.

  C. Cấu hình và Khởi động Ngrok (QUAN TRỌNG cho Webhook)

  Vì PayOS cần gửi Webhook đến server của bạn, và server của bạn đang chạy trên localhost (không thể truy cập từ internet), bạn cần một công cụ để tạo một public URL cho server của mình. ngrok là lựa
  chọn phổ biến.

   1. Tải xuống và cài đặt ngrok: Truy cập ngrok.com (https://ngrok.com/download) để tải và làm theo hướng dẫn cài đặt.
   2. Khởi động ngrok: Mở một cửa sổ Terminal/Command Prompt mới và chạy lệnh:
   1     ngrok http 3000
   3. Lấy Public URL: Ngrok sẽ hiển thị một URL công khai (ví dụ: https://xxxx-your-region.ngrok-free.app). Hãy copy URL này.
   4. Cấu hình Webhook trong PayOS:
       * Đăng nhập vào trang quản lý PayOS của bạn.
       * Tìm đến phần cài đặt Webhook và dán public URL từ ngrok vào đó (ví dụ: https://xxxx-your-region.ngrok-free.app/payment/webhook).

  D. Cấu hình và Khởi động Mobile App (React Native)

   1. Mở tệp payos-demo-app/App.js trong thư mục project của bạn.
   2. Tìm dòng const BACKEND_URL = 'http://YOUR_BACKEND_IP:3000';
   3. Thay thế `YOUR_BACKEND_IP`:
       * Nếu bạn đang sử dụng Android Emulator: thường là http://10.0.2.2:3000.
       * Nếu bạn đang sử dụng iOS Simulator: http://localhost:3000 hoặc http://127.0.0.1:3000.
       * Nếu bạn đang chạy trên thiết bị thật (Android/iOS): Bạn cần tìm địa chỉ IP cục bộ của máy tính đang chạy Backend Server (ví dụ: 192.168.1.XX). Bạn có thể tìm bằng lệnh ipconfig (Windows)
         hoặc ifconfig (macOS/Linux) và tìm IP trong mạng nội bộ.
   4. Mở một cửa sổ Terminal/Command Prompt mới.
   5. Điều hướng đến thư mục payos-demo-app:
   1     cd D:\UIT\Document_UIT\3th-Year\IE307\DEMO_SEMINAR\payos-demo-app
   6. Cài đặt dependencies nếu bạn chưa làm (tôi đã chạy lệnh này ở trên):
   1     npm install
   7. Khởi động Expo development server:
   1     npx expo start
   8. Chạy ứng dụng:
       * Nếu bạn có ứng dụng Expo Go trên điện thoại: Quét mã QR hiển thị trong Terminal.
       * Nếu bạn muốn chạy trên emulator: Bấm a cho Android hoặc i cho iOS trong Terminal.

  E. Chú ý về `RETURN_URL` và `CANCEL_URL`

  Trong server/src/payment.controller.js, bạn thấy RETURN_URL và CANCEL_URL đang được đặt là https://your-domain.com/return.

   * Quan trọng: Trong một ứng dụng thực tế, các URL này phải là các URL có thể truy cập được từ internet và bạn có thể lắng nghe sự kiện khi người dùng được điều hướng về.
   * Với demo này: Chúng ta đang giả định rằng sau khi thanh toán trên PayOS WebView hoàn tất, WebView sẽ cố gắng điều hướng về các URL này. Mobile App của chúng ta (trong PaymentScreen) sẽ lắng nghe
     các URL này để biết khi nào người dùng đã hoàn thành tương tác với PayOS, sau đó nó sẽ điều hướng đến ResultScreen của ứng dụng để kiểm tra trạng thái cuối cùng. Do đó, bạn không cần phải thay
     đổi các URL này trong tệp backend cho mục đích demo, miễn là chúng trùng khớp với URL bạn lắng nghe trong App.js.

  ---

  6. Kịch bản Demo End-to-End

  Kịch bản này giúp bạn trình bày quy trình thanh toán PayOS một cách rõ ràng:

  A. Chuẩn bị:

   1. Đảm bảo Backend Server đang chạy (kiểm tra cửa sổ Terminal của backend).
   2. Đảm bảo ngrok đang chạy và Public URL đã được cấu hình trong PayOS Webhook (kiểm tra cửa sổ Terminal của ngrok và trang quản lý PayOS).
   3. Đảm bảo Mobile App đang chạy trên thiết bị/emulator (kiểm tra ứng dụng trên điện thoại/emulator và cửa sổ Terminal của Expo).

  B. Bắt đầu Demo:

   1. Màn hình sản phẩm (Product Screen) trên Mobile App:
       * Giới thiệu giao diện ứng dụng, có một "Gói Premium" với giá 20.000đ.
       * Giải thích: "Đây là màn hình sản phẩm, người dùng có thể chọn mua các gói dịch vụ. Khi bấm nút 'Thanh toán ngay', ứng dụng sẽ gọi API đến Backend Server để tạo link thanh toán."

   2. Bấm "Thanh toán ngay":
       * Bấm nút "Thanh toán ngay" trên app.
       * Giải thích: "Ứng dụng vừa gửi yêu cầu POST /payment/create-link đến Backend. Backend đã tạo một đơn hàng (trong DB in-memory) với trạng thái PENDING và gọi PayOS để lấy checkoutUrl. Bây giờ,
         ứng dụng sẽ mở checkoutUrl này trong một WebView."

   3. Màn hình thanh toán PayOS (Payment Screen - WebView):
       * Mobile App chuyển sang màn hình WebView hiển thị giao diện thanh toán của PayOS.
       * Giải thích: "Đây là cổng thanh toán chính thức của PayOS. Người dùng sẽ thực hiện thanh toán trực tiếp tại đây. Với PayOS, chúng ta có thể thấy các phương thức như quét VietQR."

   4. Thực hiện thanh toán (sử dụng app ngân hàng):
       * Sử dụng một ứng dụng ngân hàng bất kỳ để quét mã VietQR hiển thị trên giao diện PayOS.
       * Hoàn tất giao dịch trong ứng dụng ngân hàng.
       * Quan sát trên cửa sổ Terminal của Backend: Bạn sẽ thấy log thông báo Webhook được nhận và đơn hàng được cập nhật trạng thái thành PAID. (Ví dụ: Webhook received and verified: { ... },
         Updated order 123456 to status PAID).
       * Giải thích: "Ngay khi giao dịch thành công trên PayOS, PayOS lập tức gửi một Webhook đến Backend Server của chúng ta thông qua ngrok. Backend đã nhận và xác thực Webhook, sau đó cập nhật
         trạng thái đơn hàng thành 'PAID' trong hệ thống của chúng ta. Đây là cơ chế real-time để Backend luôn nắm bắt được trạng thái chính xác của giao dịch."

   5. Màn hình kết quả (Result Screen) trên Mobile App:
       * Sau khi thanh toán thành công, PayOS sẽ điều hướng WebView về returnUrl. Mobile App của bạn sẽ phát hiện điều này và tự động chuyển sang màn hình kết quả.
       * Giải thích: "Ứng dụng di động của chúng ta đã phát hiện người dùng đã hoàn tất tương tác với PayOS. Ngay lập tức, nó gọi API GET /order/:orderCode đến Backend để kiểm tra trạng thái cuối
         cùng của đơn hàng. Và như chúng ta thấy, trạng thái đã là 'Thanh toán thành công!'."

   6. Tổng kết:
       * Tóm tắt toàn bộ quy trình: "Vậy là chúng ta đã thấy một quy trình thanh toán PayOS khép kín: từ việc đặt hàng trên ứng dụng di động, gọi API đến Backend để tạo link PayOS, người dùng thanh
         toán, PayOS trả về Webhook để cập nhật trạng thái Backend, và cuối cùng, ứng dụng di động kiểm tra Backend để hiển thị kết quả chính xác cho người dùng."

  ---

  Bạn đã có tất cả các phần cần thiết để xây dựng và trình bày demo của mình. Chúc bạn thành công!